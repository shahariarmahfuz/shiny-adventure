{% extends "layout.html" %}

{% block content %}
<style>
  /* --- Global Styles --- */
  .page-title {
    font-size: 24px;
    font-weight: 600;
    color: #111827;
    margin-bottom: 24px;
  }

  .create-card {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    margin-bottom: 24px;
  }

  .form-label { font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px; display:block; }

  .input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    border: none;
    cursor: pointer;
  }

  .btn-primary { background:#0969da; color:#fff; }

  .muted-text { font-size:13px; color:#6b7280; margin-top:10px; }

  /* --- TABLE --- */
  .table { width:100%; border-collapse:collapse; font-size:14px; }
  .table th {
    text-align:left;
    padding:12px;
    border-bottom:1px solid #e5e7eb;
    color:#6b7280;
    font-size:12px;
    text-transform:uppercase;
  }

  .table td {
    padding:14px;
    border-bottom:1px solid #f3f4f6;
    vertical-align:top;
  }

  .gmail { font-weight:700; color:#111827; font-size:14px; }
  .generated { font-size:12px; color:#6b7280; word-break:break-all; }

  /* --- Inline status row --- */
  .inline-meta {
    display:flex;
    align-items:center;
    gap:14px;
    font-size:12px;
    color:#374151;
    margin-top:6px;
    flex-wrap:wrap;
  }

  .meta-item {
    display:inline-flex;
    align-items:center;
    gap:4px;
    white-space:nowrap;
  }

  .icon {
    width:14px;
    height:14px;
  }

  .active { color:#1a7f37; font-weight:600; }
  .setup { color:#9a6700; font-weight:600; }

  /* --- MOBILE --- */
  @media (max-width:768px) {
    .table thead { display:none; }

    .table tbody {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap:12px;
    }

    .table tr {
      display:block;
      border:1px solid #e5e7eb;
      border-radius:10px;
      padding:12px;
      background:#fff;
    }

    .table td {
      border:none;
      padding:0;
    }
  }
</style>

<h1 class="page-title">Dashboard</h1>

<div class="create-card">
  <h2 style="font-size:16px;margin-bottom:10px;">Create new email</h2>
  <form method="post" action="{{ url_for('create_account') }}">
    <label class="form-label">Gmail address</label>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <input class="input" name="gmail" type="email" required placeholder="user@gmail.com">
      <button class="btn btn-primary" type="submit">Create</button>
    </div>
  </form>
  <p class="muted-text">Link generated email & authenticator code after creation.</p>
</div>

{% if not accounts %}
  <div style="padding:40px;text-align:center;color:#6b7280;border:1px solid #e5e7eb;border-radius:12px;background:#fff;">
    No emails found.
  </div>
{% else %}
<table class="table">
  <thead>
    <tr>
      <th>Email</th>
    </tr>
  </thead>
  <tbody>
  {% for a in accounts %}
    <tr>
      <td>
        <div class="gmail">{{ a.gmail }}</div>
        <div class="generated">
          <a href="{{ url_for('account_view', account_id=a.id) }}" style="color:#6b7280;text-decoration:none;">
            {{ a.email }}
          </a>
        </div>

        <div class="inline-meta">
          <!-- Status -->
          <span class="meta-item">
            {% if a.has_totp %}
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
              </svg>
              <span class="active">Active</span>
            {% else %}
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
              </svg>
              <span class="setup">Setup</span>
            {% endif %}
          </span>

          <!-- Messages -->
          <span class="meta-item">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75"/>
            </svg>
            {{ a.msg_count }}
          </span>

          <!-- Time -->
          <span class="meta-item">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 2.994v2.25m10.5-2.25v2.25m-14.252 13.5V7.491a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v11.251"/>
            </svg>
            <span class="bd-time" data-time="{{ a.last_received or '' }}">-</span>
          </span>
        </div>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.bd-time').forEach(el => {
    const raw = el.dataset.time;
    if (!raw) return;
    const d = new Date(raw);
    if (!isNaN(d)) {
      el.textContent = d.toLocaleString('en-BD', {
        timeZone:'Asia/Dhaka',
        month:'short', day:'numeric',
        hour:'numeric', minute:'2-digit', hour12:true
      });
    }
  });
});
</script>

{% endblock %}
